(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{2610:(t,e,r)=>{"use strict";r.d(e,{_:()=>l,e:()=>i});var s=r(5155),n=r(2115);let a=(0,n.createContext)();function i(t){let{children:e}=t,[r,i]=(0,n.useState)([]),[l,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let t=localStorage.getItem("cart");t&&i(JSON.parse(t))},[]),(0,n.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(r))},[r]);let u=t=>{i(e=>e.filter(e=>e.id!==t))};return(0,s.jsx)(a.Provider,{value:{cartItems:r,addToCart:t=>{i(e=>e.find(e=>e.id===t.id)?e.map(e=>e.id===t.id?{...e,quantity:e.quantity+1}:e):[...e,{...t,quantity:1}])},removeFromCart:u,updateQuantity:(t,e)=>{if(e<=0)return void u(t);i(r=>r.map(r=>r.id===t?{...r,quantity:e}:r))},getTotalPrice:()=>r.reduce((t,e)=>t+e.price*e.quantity,0),getTotalItems:()=>r.reduce((t,e)=>t+e.quantity,0),clearCart:()=>{i([])},isOpen:l,setIsOpen:o},children:e})}let l=()=>{let t=(0,n.useContext)(a);if(!t)throw Error("useCart must be used within CartProvider");return t}},3074:(t,e,r)=>{Promise.resolve().then(r.bind(r,5391))},4436:(t,e,r)=>{"use strict";r.d(e,{k5:()=>c});var s=r(2115),n={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=s.createContext&&s.createContext(n),i=["attr","size","title"];function l(){return(l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])}return t}).apply(this,arguments)}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,s)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach(function(e){var s,n,a;s=t,n=e,a=r[e],(n=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var s=r.call(t,e||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(n))in s?Object.defineProperty(s,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[n]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function c(t){return e=>s.createElement(d,l({attr:u({},t.attr)},e),function t(e){return e&&e.map((e,r)=>s.createElement(e.tag,u({key:r},e.attr),t(e.child)))}(t.child))}function d(t){var e=e=>{var r,{attr:n,size:a,title:o}=t,c=function(t,e){if(null==t)return{};var r,s,n=function(t,e){if(null==t)return{};var r={};for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)){if(e.indexOf(s)>=0)continue;r[s]=t[s]}return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(s=0;s<a.length;s++)r=a[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}(t,i),d=a||e.size||"1em";return e.className&&(r=e.className),t.className&&(r=(r?r+" ":"")+t.className),s.createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,n,c,{className:r,style:u(u({color:t.color||e.color},e.style),t.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),o&&s.createElement("title",null,o),t.children)};return void 0!==a?s.createElement(a.Consumer,null,t=>e(t)):e(n)}},5041:(t,e,r)=>{"use strict";r.d(e,{n:()=>c});var s=r(2115),n=r(4560),a=r(7165),i=r(5910),l=r(2020),o=class extends i.Q{#t;#e=void 0;#r;#s;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#t.defaultMutationOptions(t),(0,l.f8)(this.options,e)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,l.EN)(e.mutationKey)!==(0,l.EN)(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(t){this.#n(),this.#a(t)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#a()}mutate(t,e){return this.#s=e,this.#r?.removeObserver(this),this.#r=this.#t.getMutationCache().build(this.#t,this.options),this.#r.addObserver(this),this.#r.execute(t)}#n(){let t=this.#r?.state??(0,n.$)();this.#e={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#a(t){a.jG.batch(()=>{if(this.#s&&this.hasListeners()){let e=this.#e.variables,r=this.#e.context;t?.type==="success"?(this.#s.onSuccess?.(t.data,e,r),this.#s.onSettled?.(t.data,null,e,r)):t?.type==="error"&&(this.#s.onError?.(t.error,e,r),this.#s.onSettled?.(void 0,t.error,e,r))}this.listeners.forEach(t=>{t(this.#e)})})}},u=r(6715);function c(t,e){let r=(0,u.jE)(e),[n]=s.useState(()=>new o(r,t));s.useEffect(()=>{n.setOptions(t)},[n,t]);let i=s.useSyncExternalStore(s.useCallback(t=>n.subscribe(a.jG.batchCalls(t)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),c=s.useCallback((t,e)=>{n.mutate(t,e).catch(l.lQ)},[n]);if(i.error&&(0,l.GU)(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:c,mutateAsync:i.mutate}}},5391:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>m});var s=r(5155),n=r(2610),a=r(7674),i=r(5695),l=r(5041),o=r(9012);let u={initiateCartPayment:async t=>(await o.F.post("/payment/cart",{items:t,totalAmount:t.reduce((t,e)=>t+e.price*e.quantity,0)})).data};var c=r(2115),d=r(6766),h=r(2515);let m=function(){let{cartItems:t,updateQuantity:e,removeFromCart:r,getTotalPrice:o,clearCart:m}=(0,n._)(),{isAuthenticated:p}=(0,a.A)(),f=(0,i.useRouter)(),b=(()=>{let{isAuthenticated:t}=(0,a.A)();return(0,l.n)({mutationFn:e=>{if(!t)throw Error("Authentication required for payment");return u.initiateCartPayment(e)},onSuccess:t=>{t.paymentUrl&&(window.location.href=t.paymentUrl)}})})(),[y,x]=(0,c.useState)("zarinpal"),g=async()=>{if(!p){localStorage.setItem("pendingCartPayment",JSON.stringify(t)),f.push("/auth/login?returnTo=/cart&action=checkout");return}try{await b.mutateAsync(t)}catch(t){console.error("Payment failed:",t),alert("خطا در پردازش پرداخت")}};return 0===t.length?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 text-center",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"سبد خرید"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[(0,s.jsx)("p",{className:"text-gray-600 text-lg",children:"سبد خرید شما خالی است"}),(0,s.jsx)("a",{href:"/products",className:"inline-block mt-4 bg-primary text-white px-6 py-3 rounded-lg",children:"بازگشت به فروشگاه"})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"سبد خرید"}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:t.map(t=>(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 py-4 last:border-b-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden",children:(0,s.jsx)(d.default,{src:t.image,alt:t.name,fill:!0,className:"object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-gray-800",children:t.name}),(0,s.jsxs)("p",{className:"text-gray-600",children:[t.price.toLocaleString()," تومان"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>e(t.id,t.quantity-1),className:"p-1 bg-gray-200 rounded-lg hover:bg-gray-300",children:(0,s.jsx)(h.ak5,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"mx-2 font-bold",children:t.quantity}),(0,s.jsx)("button",{onClick:()=>e(t.id,t.quantity+1),className:"p-1 bg-gray-200 rounded-lg hover:bg-gray-300",children:(0,s.jsx)(h.jgn,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"text-lg font-bold text-primary",children:[(t.price*t.quantity).toLocaleString()," تومان"]}),(0,s.jsx)("button",{onClick:()=>r(t.id),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:(0,s.jsx)(h.b6i,{className:"w-5 h-5"})})]})]},t.id))}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("span",{className:"text-xl font-bold",children:"مجموع:"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-primary",children:[o().toLocaleString()," تومان"]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4",children:"روش پرداخت"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"payment",value:"zarinpal",checked:"zarinpal"===y,onChange:t=>x(t.target.value),className:"ml-2"}),(0,s.jsx)("span",{children:"پرداخت آنلاین (زرین‌پال)"})]}),p&&(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"payment",value:"balance",checked:"balance"===y,onChange:t=>x(t.target.value),className:"ml-2"}),(0,s.jsx)("span",{children:"پرداخت از موجودی حساب"})]})]})]}),!p&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded",children:"برای پرداخت نیاز به ورود به حساب کاربری دارید"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:m,className:"flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold",children:"پاک کردن سبد"}),(0,s.jsx)("button",{onClick:g,disabled:b.isLoading,className:"flex-1 bg-primary hover:bg-primary-dark text-white py-3 rounded-lg font-bold disabled:opacity-50",children:b.isLoading?"در حال پردازش...":p?"پرداخت":"ورود و پرداخت"})]})]})]})})}},5695:(t,e,r)=>{"use strict";var s=r(8999);r.o(s,"usePathname")&&r.d(e,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(e,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(e,{useSearchParams:function(){return s.useSearchParams}})},6654:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"useMergedRef",{enumerable:!0,get:function(){return n}});let s=r(2115);function n(t,e){let r=(0,s.useRef)(null),n=(0,s.useRef)(null);return(0,s.useCallback)(s=>{if(null===s){let t=r.current;t&&(r.current=null,t());let e=n.current;e&&(n.current=null,e())}else t&&(r.current=a(t,s)),e&&(n.current=a(e,s))},[t,e])}function a(t,e){if("function"!=typeof t)return t.current=e,()=>{t.current=null};{let r=t(e);return"function"==typeof r?r:()=>t(null)}}("function"==typeof e.default||"object"==typeof e.default&&null!==e.default)&&void 0===e.default.__esModule&&(Object.defineProperty(e.default,"__esModule",{value:!0}),Object.assign(e.default,e),t.exports=e.default)},7674:(t,e,r)=>{"use strict";r.d(e,{A:()=>o,O:()=>l});var s=r(5155),n=r(2115),a=r(9012);let i=(0,n.createContext)();function l(t){let{children:e}=t,[r,l]=(0,n.useState)(null),[o,u]=(0,n.useState)(!0),[c,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{h()},[]);let h=async()=>{try{let t=await a.F.get("/auth/me");l(t.data.user),d(!0)}catch(t){l(null),d(!1)}finally{u(!1)}},m=async t=>{l(t),d(!0)},p=async()=>{try{await a.F.post("/auth/logout"),l(null),d(!1)}catch(t){console.error("Logout error:",t)}};return(0,s.jsx)(i.Provider,{value:{user:r,isAuthenticated:c,isLoading:o,login:m,logout:p,checkAuthStatus:h},children:e})}let o=()=>{let t=(0,n.useContext)(i);if(!t)throw Error("useAuth must be used within AuthProvider");return t}},9012:(t,e,r)=>{"use strict";r.d(e,{F:()=>s});let s=r(3464).A.create({baseURL:"http://localhost:4000",withCredentials:!0})}},t=>{t.O(0,[479,464,766,144,441,964,358],()=>t(t.s=3074)),_N_E=t.O()}]);