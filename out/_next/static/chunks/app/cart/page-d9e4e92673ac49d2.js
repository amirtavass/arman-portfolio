(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{2610:(e,t,r)=>{"use strict";r.d(t,{_:()=>l,e:()=>i});var s=r(5155),n=r(2115);let a=(0,n.createContext)();function i(e){let{children:t}=e,[r,i]=(0,n.useState)([]),[l,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=localStorage.getItem("cart");e&&i(JSON.parse(e))},[]),(0,n.useEffect)(()=>{localStorage.setItem("cart",JSON.stringify(r))},[r]);let u=e=>{i(t=>t.filter(t=>t.id!==e))};return(0,s.jsx)(a.Provider,{value:{cartItems:r,addToCart:e=>{i(t=>t.find(t=>t.id===e.id)?t.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t):[...t,{...e,quantity:1}])},removeFromCart:u,updateQuantity:(e,t)=>{if(t<=0)return void u(e);i(r=>r.map(r=>r.id===e?{...r,quantity:t}:r))},getTotalPrice:()=>r.reduce((e,t)=>e+t.price*t.quantity,0),getTotalItems:()=>r.reduce((e,t)=>e+t.quantity,0),clearCart:()=>{i([])},isOpen:l,setIsOpen:o},children:t})}let l=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useCart must be used within CartProvider");return e}},3074:(e,t,r)=>{Promise.resolve().then(r.bind(r,5391))},4436:(e,t,r)=>{"use strict";r.d(t,{k5:()=>c});var s=r(2115),n={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=s.createContext&&s.createContext(n),i=["attr","size","title"];function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,s)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){var s,n,a;s=e,n=t,a=r[t],(n=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=typeof s)return s;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(n))in s?Object.defineProperty(s,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[n]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function c(e){return t=>s.createElement(d,l({attr:u({},e.attr)},t),function e(t){return t&&t.map((t,r)=>s.createElement(t.tag,u({key:r},t.attr),e(t.child)))}(e.child))}function d(e){var t=t=>{var r,{attr:n,size:a,title:o}=e,c=function(e,t){if(null==e)return{};var r,s,n=function(e,t){if(null==e)return{};var r={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;r[s]=e[s]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,i),d=a||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),s.createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,c,{className:r,style:u(u({color:e.color||t.color},t.style),e.style),height:d,width:d,xmlns:"http://www.w3.org/2000/svg"}),o&&s.createElement("title",null,o),e.children)};return void 0!==a?s.createElement(a.Consumer,null,e=>t(e)):t(n)}},5041:(e,t,r)=>{"use strict";r.d(t,{n:()=>c});var s=r(2115),n=r(4560),a=r(7165),i=r(5910),l=r(2020),o=class extends i.Q{#e;#t=void 0;#r;#s;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#n()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,l.f8)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,l.EN)(t.mutationKey)!==(0,l.EN)(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#n(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#n(),this.#a()}mutate(e,t){return this.#s=t,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(e)}#n(){let e=this.#r?.state??(0,n.$)();this.#t={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#a(e){a.jG.batch(()=>{if(this.#s&&this.hasListeners()){let t=this.#t.variables,r=this.#t.context;e?.type==="success"?(this.#s.onSuccess?.(e.data,t,r),this.#s.onSettled?.(e.data,null,t,r)):e?.type==="error"&&(this.#s.onError?.(e.error,t,r),this.#s.onSettled?.(void 0,e.error,t,r))}this.listeners.forEach(e=>{e(this.#t)})})}},u=r(6715);function c(e,t){let r=(0,u.jE)(t),[n]=s.useState(()=>new o(r,e));s.useEffect(()=>{n.setOptions(e)},[n,e]);let i=s.useSyncExternalStore(s.useCallback(e=>n.subscribe(a.jG.batchCalls(e)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),c=s.useCallback((e,t)=>{n.mutate(e,t).catch(l.lQ)},[n]);if(i.error&&(0,l.GU)(n.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:c,mutateAsync:i.mutate}}},5391:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),n=r(2610),a=r(7674),i=r(5695),l=r(5041),o=r(9012);let u={initiateCartPayment:async e=>(await o.F.post("/payment/cart",{items:e,totalAmount:e.reduce((e,t)=>e+t.price*t.quantity,0)})).data};var c=r(2115),d=r(6766),h=r(2515);let m=function(){let{cartItems:e,updateQuantity:t,removeFromCart:r,getTotalPrice:o,clearCart:m}=(0,n._)(),{isAuthenticated:p}=(0,a.A)(),f=(0,i.useRouter)(),b=(()=>{let{isAuthenticated:e}=(0,a.A)();return(0,l.n)({mutationFn:t=>{if(!e)throw Error("Authentication required for payment");return u.initiateCartPayment(t)},onSuccess:e=>{e.paymentUrl&&(window.location.href=e.paymentUrl)}})})(),[y,x]=(0,c.useState)("zarinpal"),g=async()=>{if(!p){localStorage.setItem("pendingCartPayment",JSON.stringify(e)),f.push("/auth/login?returnTo=/cart&action=checkout");return}try{await b.mutateAsync(e)}catch(e){console.error("Payment failed:",e),alert("خطا در پردازش پرداخت")}};return 0===e.length?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 text-center",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"سبد خرید"}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8",children:[(0,s.jsx)("p",{className:"text-gray-600 text-lg",children:"سبد خرید شما خالی است"}),(0,s.jsx)("a",{href:"/products",className:"inline-block mt-4 bg-primary text-white px-6 py-3 rounded-lg",children:"بازگشت به فروشگاه"})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-8",children:"سبد خرید"}),(0,s.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:e.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-200 py-4 last:border-b-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"relative w-16 h-16 rounded-lg overflow-hidden",children:(0,s.jsx)(d.default,{src:e.image,alt:e.name,fill:!0,className:"object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-gray-800",children:e.name}),(0,s.jsxs)("p",{className:"text-gray-600",children:[e.price.toLocaleString()," تومان"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>t(e.id,e.quantity-1),className:"p-1 bg-gray-200 rounded-lg hover:bg-gray-300",children:(0,s.jsx)(h.ak5,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"mx-2 font-bold",children:e.quantity}),(0,s.jsx)("button",{onClick:()=>t(e.id,e.quantity+1),className:"p-1 bg-gray-200 rounded-lg hover:bg-gray-300",children:(0,s.jsx)(h.jgn,{className:"w-4 h-4"})})]}),(0,s.jsxs)("div",{className:"text-lg font-bold text-primary",children:[(e.price*e.quantity).toLocaleString()," تومان"]}),(0,s.jsx)("button",{onClick:()=>r(e.id),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg",children:(0,s.jsx)(h.b6i,{className:"w-5 h-5"})})]})]},e.id))}),(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("span",{className:"text-xl font-bold",children:"مجموع:"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-primary",children:[o().toLocaleString()," تومان"]})]}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4",children:"روش پرداخت"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"payment",value:"zarinpal",checked:"zarinpal"===y,onChange:e=>x(e.target.value),className:"ml-2"}),(0,s.jsx)("span",{children:"پرداخت آنلاین (زرین‌پال)"})]}),p&&(0,s.jsxs)("label",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"radio",name:"payment",value:"balance",checked:"balance"===y,onChange:e=>x(e.target.value),className:"ml-2"}),(0,s.jsx)("span",{children:"پرداخت از موجودی حساب"})]})]})]}),!p&&(0,s.jsx)("div",{className:"mb-4 p-3 bg-yellow-100 border border-yellow-400 text-yellow-800 rounded",children:"برای پرداخت نیاز به ورود به حساب کاربری دارید"}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:m,className:"flex-1 bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold",children:"پاک کردن سبد"}),(0,s.jsx)("button",{onClick:g,disabled:b.isLoading,className:"flex-1 bg-primary hover:bg-primary-dark text-white py-3 rounded-lg font-bold disabled:opacity-50",children:b.isLoading?"در حال پردازش...":p?"پرداخت":"ورود و پرداخت"})]})]})]})})}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},6654:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return n}});let s=r(2115);function n(e,t){let r=(0,s.useRef)(null),n=(0,s.useRef)(null);return(0,s.useCallback)(s=>{if(null===s){let e=r.current;e&&(r.current=null,e());let t=n.current;t&&(n.current=null,t())}else e&&(r.current=a(e,s)),t&&(n.current=a(t,s))},[e,t])}function a(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7674:(e,t,r)=>{"use strict";r.d(t,{A:()=>o,O:()=>l});var s=r(5155),n=r(2115),a=r(9012);let i=(0,n.createContext)();function l(e){let{children:t}=e,[r,l]=(0,n.useState)(null),[o,u]=(0,n.useState)(!0),[c,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{h()},[]);let h=async()=>{try{let e=await a.F.get("/auth/me");l(e.data.user),d(!0)}catch(e){l(null),d(!1)}finally{u(!1)}},m=async e=>{l(e),d(!0)},p=async()=>{try{await a.F.post("/auth/logout"),l(null),d(!1)}catch(e){console.error("Logout error:",e)}};return(0,s.jsx)(i.Provider,{value:{user:r,isAuthenticated:c,isLoading:o,login:m,logout:p,checkAuthStatus:h},children:t})}let o=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},9012:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});let s=r(3464).A.create({baseURL:"parsswim-backend-production.up.railway.app",withCredentials:!0,timeout:15e3});s.interceptors.request.use(e=>e,e=>Promise.reject(e)),s.interceptors.response.use(e=>e,e=>{var t,r,s;return console.error("API Error:",(null==(t=e.response)?void 0:t.data)||e.message),(null==(r=e.response)?void 0:r.status)===401&&console.log("Authentication required"),(null==(s=e.response)?void 0:s.status)>=500&&console.error("Server error - please try again later"),Promise.reject(e)})}},e=>{e.O(0,[479,464,766,144,441,964,358],()=>e(e.s=3074)),_N_E=e.O()}]);